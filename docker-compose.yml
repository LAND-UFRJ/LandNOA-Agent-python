services:
  chroma:
    image: chromadb/chroma:latest
    container_name: chroma
    ports:
      - "8000:8000"
    volumes:
      - ./chroma-data:/data
    command: ["run", "--host", "0.0.0.0", "--port", "8000"]
    restart: unless-stopped

  backend:
    build: .
    depends_on:
      - chroma
    ports:
      - "10000:10000"
    environment:
      - CHROMA_HOST=chroma
      - CHROMA_PORT=8000
      - SQLITE_PATH=/shared/config.db
      - AGENT_PORT=10000
      - HOST_IP=${HOST_IP}
    volumes:
      - ./shared:/shared
    command: ["sh","-c","until curl -sS http://chroma:8000/ >/dev/null 2>&1; do sleep 1; done; python3 backend/agente/root_agent.py"]
    restart: unless-stopped

  frontend:
    build: .
    depends_on:
      - chroma
    ports:
      - "8501:8501"
    environment:
      - CHROMA_HOST=chroma
      - CHROMA_PORT=8000
      - SQLITE_PATH=/shared/config.db
    volumes:
      - ./shared:/shared
    command: ["sh","-c","until curl -sS http://chroma:8000/ >/dev/null 2>&1; do sleep 1; done; python3 -m streamlit run frontend/app.py --server.address 0.0.0.0 --server.port 8501"]
    restart: unless-stopped
